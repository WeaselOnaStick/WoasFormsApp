@page "/MyForms/"
@rendermode InteractiveServer
@inject IDatabaseAccessorService dba

@attribute [Authorize]

<PaperCenter Title="My Forms">
    @if (_responses == null || !_responses.Any()){
        <MudText>
            You have not filled any forms yet.
        </MudText>
        <MudLink Href="/">
            Browse Templates
        </MudLink>
    }
    else
    {
        <MudDataGrid T="Response" Items="_responses" Elevation="2" Striped="true" Dense="true">
            <Columns>
                <PropertyColumn Property="@(r => (r.Template == null || r.Template.Owner == null) ? "No Owner (Orphan Template)" : r.Template.Owner.UserName)" Title="Template Author"/>
                <PropertyColumn Property="@(r => (r.Template == null || string.IsNullOrWhiteSpace(r.Template.Title)) ? "Unnamed Template" : r.Template.Title )" Title="Template Title" />
                <PropertyColumn Property="r => r.CreationDate" Title="Filled On" />
                <TemplateColumn>
                    <CellTemplate>
                        <MudFab Size="Size.Small" Href="@($"/Form/{context.Item.Id}")" StartIcon="@Icons.Material.Filled.Visibility" Variant="Variant.Filled" Color="Color.Info"/>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>
    }
</PaperCenter>

@code{
    private IEnumerable<Response> _responses;

    protected override async Task OnInitializedAsync()
    {
        _responses = await dba.GetResponsesByCurrentUser();
    }
}