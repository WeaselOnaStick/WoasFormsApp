@page "/SearchTemplate"
@using WoasFormsApp.Components.Template
@rendermode InteractiveServer
@inject IDatabaseAccessorService dba


<PaperCenter Title="Search">
    <MudText Align="Align.Center" Typo="Typo.h5">Templates Search</MudText>
    <MudMenu Label="Search Options" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.FilterList">
        @foreach (var kv in IDatabaseAccessorService.TemplateOrdersData)
        {
            <MudMenuItem Label=@kv.Value.DisplayName OnClick="async _ => {_orderMode = kv.Key; await FetchTemplates();}"/>
        }
    </MudMenu>
    <TemplatesGallery Mode="Components.Template.TemplatesGallery.GalleryMode.CustomList" CustomTemplates="_searchResults"/>
</PaperCenter>

@code {
    private List<Template>? _searchResults;

    private TemplateOrderMode _orderMode = TemplateOrderMode.Newest;

    [Parameter]
    [SupplyParameterFromQuery(Name = "search")]
    public string searchString { get; set; }

    [Parameter]
    [SupplyParameterFromQuery(Name = "author")]
    public string searchAuthor { get; set; }

    [Parameter]
    [SupplyParameterFromQuery(Name = "tag")]
    public string searchTag { get; set; }



    protected override async Task OnInitializedAsync()
    {
        await FetchTemplates();
    }

    private async Task FetchTemplates()
    {
        _searchResults = new List<Template>(await dba.SearchTemplates(_orderMode, searchString, searchAuthor, searchTag));
        StateHasChanged();
    }
}
