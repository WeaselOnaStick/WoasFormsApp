@page "/Template/{TemplateId:int}"
@rendermode InteractiveServer
@inject IDatabaseAccessorService dba
@inject NavigationManager nav


@if (_template == null) 
{
    <TemplateUnaccessible />
}
else
{

<PageTitle>Template "@_template.Title"</PageTitle>

<MudGrid Justify="Justify.Center" Class="pt-12">
    <MudItem xs="10">
        <MudPaper Class="p-4">
            <MudGrid Justify="Justify.SpaceEvenly">
                <MudItem md="8" xs="12">
                    <MudText style="white-space: nowrap; max-width: fit-content; display: inline; vertical-align: middle;" Class="pb-2 pr-4" Typo="Typo.h3">@_template.Title</MudText>
                    <MudButton StartIcon="@Icons.Material.Filled.Checklist" IconSize="Size.Large" Class="rounded-pill" Color="Color.Info" Variant="Variant.Filled" Href=@($"/Template/Fill/{TemplateId}")>Fill Form</MudButton>
                        
                    <MudText Typo="Typo.body1" Style="font-style: italic;">Created by @(_template.Owner.UserName ?? "(Orphan Template)") on @(_template.CreatedAt.ToLocalTime().ToLongDateString()) @(_template.CreatedAt.ToLocalTime().ToShortTimeString()) </MudText>
                </MudItem>
                <MudItem md="4" xs="12">
                    <div class="rounded-pill mud-theme-secondary py-2 px-6 mx-4 my-6">
                        <MudText Align="Align.Center" Typo="Typo.h4" Class="rounded-pill">@_template.Topic.Title</MudText>
                    </div>
                    <MudGrid Spacing="1" Justify="Justify.SpaceEvenly">
                        @foreach (var tag in _template.Tags)
                        {
                            <MudItem>
                                <MudChip T="string" Icon="@Icons.Material.Filled.Tag" Color="Color.Info" Variant="Variant.Filled">@tag.Title</MudChip>
                            </MudItem>
                        }

                    </MudGrid>

                </MudItem>
            </MudGrid>
            @if (!string.IsNullOrWhiteSpace(_template.CoverImageUrl))
            {
                <MudImage Src="@_template.CoverImageUrl" />
            }
            <MudMarkdown Value="@(string.IsNullOrWhiteSpace(_template.Description) ? "__(No Description Provided)__" : _template.Description)"></MudMarkdown>

            <MudToolBar>
                
            </MudToolBar>

            <TemplateCommentsSection />

        </MudPaper>
    </MudItem>
</MudGrid>
}


@code {
    [Parameter]
    public int TemplateId { get; set; }

    private Template _template { get; set; }

    protected override async Task OnInitializedAsync()
    {
        _template = await dba.GetTemplate(TemplateId);
        
    }
}
